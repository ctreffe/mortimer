{% extends "layout_experiment.html" %}


{% block content %}


<div class="">
  <h6 class="pt-2"><b>Access</b></h6>

      {% if experiment.active == True %}

      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <form method="POST" action="{{ url_for('web_experiments.de_activate_experiment', experiment_title=experiment.title, username=experiment.author) }}">
            <button class="btn btn-warning" type="submit"><i class='fas fa-stop-circle mr-2'></i>{{ toggle_button }}</button>
          
        </form>
        </div>
      <input type="text" class="form-control" aria-describedby="basic-addon2" id="link-to-exp" value="{{ url_for('alfredo.start', expid=expid, _external=True) }}">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" data-clipboard-target="#link-to-exp">
          <img src="../static/clippy.svg" alt="Copy to clipboard" width="20"> Copy Link
        </button>
        <a class="btn btn-success" target="_blank" rel="noopener noreferrer" href="{{ url_for('alfredo.start', expid=expid) }}"><i class="fas fa-play mr-2"></i>Start</a>
      </div>
    </div>

    {% else %}

    <div class="input-group mb-3">
      <div class="input-group-prepend">
          <form method="POST" action="{{ url_for('web_experiments.de_activate_experiment', experiment_title=experiment.title, username=experiment.author) }}">
          <button class="btn btn-primary" type="submit"><i class='fas fa-play-circle mr-2'></i>{{ toggle_button }}</button>
        </form>
        </div>
      <input type="text" class="form-control" aria-describedby="basic-addon2" id="link-to-exp" placeholder="(inactive)">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" data-clipboard-target="#link-to-exp">
          <img src="{{ url_for('static', filename='clippy.svg')}}" alt="Copy to clipboard" width="20"> Copy Link
        </button>
        <a class="btn btn-success" href="#"><i class="fas fa-play mr-2"></i>Start</a>
      </div>
    </div>

    {% endif %}

    </div>

<div class="row pt-2">
      <div class="col-md-3"><small><b>Created</b></small>:</div>
      <div class="col-md-3"><span class="badge badge-light">{{ experiment.date_created.strftime('%Y-%m-%d') }}</span></div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>Current Version</b></small>:</div>
      <div class="col-md-3"><span class="badge badge-dark">{{ experiment.version }}</span></div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>Version History</b></small>:</div><div class="col-md-3">
        {% for version in experiment.available_versions %}
        <span class="badge badge-dark"> {{ version }}</span>
        {% endfor %}
      </div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>Last Finished Dataset</b></small>:</div>
      <div class="col-md-3"><span class="badge badge-light">{{ last_activity }}</span></div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>First Finished Dataset</b></small>:</div><div class="col-md-3"><span class="badge badge-light">{{ first_activity }}</span></div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>Passsword</b></small>:</div><div class="col-md-5">
        {% if experiment.public %}
        <span class="badge badge-primary">{{ password_protection }}</span>
        {% else %}
        <span>{{ experiment.password }}</span>
        {% endif %}
      </div>
    </div>

    

    {% if experiment.description %}
    <h6 class="border-bottom pt-2 mt-3"><b>Description</b></h6>

      <p class="article-content">{{ experiment.description }}</p>  
     {% else %}
     {% endif %}

    

<div class="article content-section">
  <h6 class="pt-2"><b>Data</b></h6>

      <table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">N</th>
      <th scope="col" class="text-center"><span class="badge badge-success">Finished</span></th>
      <th scope="col" class="text-center"><span class="badge badge-warning">Unfinished</span></th>
      <th scope="col" class="text-center"><span class="badge badge-dark">Total</span></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">All Versions</th>
      <td class="text-center">{{ datasets["all_finished_datasets"] }}</td>
      <td class="text-center">{{ datasets["all_unfinished_datasets"] }}</td>
      <td class="text-center">{{ datasets["all_datasets"] }}</td>
    </tr>
    {% for version, info in versions.items() %}

    <tr>
      <th scope="row">Version {{ version }} </th>
      <td class="text-center">{{ info["finished"] }}</td>
      <td class="text-center">{{  info["unfinished"] }}</td>
      <td class="text-center">{{ info["total"] }}</td>
    </tr>

    {% endfor %}
  </tbody>
</table>

    </div>


<div class="mt-5">
<form method="POST" action="{{ url_for('web_experiments.experiment', username=experiment.author, exp_title=experiment.title) }}" enctype="multipart/form-data" class="needs-validation" novalidate>
  {{ form.hidden_tag() }}
  <h6 class="border-bottom pt-2"><b>{{ form.script.label() }}</b></h6>
  <div class="form-row">
    <div class="col col-sm-2">
      
        <div class="form-group row">
          <label class="col col-form-label">Version</label>
          <div class="col">
            {% if form.version.errors %}
                        {{ form.version(class="form-control form-control-sm is-invalid") }} 

                        <div class="invalid-feedback">
                            {% for error in form.version.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                        
                    {% else %}
                    {{ form.version(class="form-control form-control-sm", placeholder=experiment.version) }}
                    {% endif %}
          </div>
        </div>             
                    
    </div>
    <div class="col">
     
      {{ form.script(class="form-control-file") }}
                    {% if form.script.errors %}
                        {% for error in form.script.errors %}
                            <span class="text-danger">{{ error }}</span><br>
                        {% endfor %}
                    {% endif %}
    </div>
  </div>
  <small id="versionHelpBlock" class="form-text text-muted">
                      Changing the version number allows you to choose, for which versions of an experiment you want to download data. If you made substantial changes to your experiment, you should change the version.
                    </small>
  <div class="form-row pt-3">
    <div class="col">
      {{ form.submit(class="btn btn-primary btn-sm", id="submit")}}
    </div>
  </div>
</form>


</div>

<div class="article content-section mt-5 float-right">

      <button type="button" class="btn btn-danger ml-1 mt-2 mb-2" data-toggle="modal" data-target="#deleteModal"><i class='fas fa-trash mr-2'></i>Delete from Mortimer</button>

</div>

<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Delete Experiment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure that you want to delete this experiment? The data stored in Mortimer will be lost! <br><br>The experimental data in the Alfred database will <b>not</b> be deleted by this.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <form method="POST" action="{{ url_for('web_experiments.delete_experiment', experiment_title=experiment.title, username=experiment.author) }}">
          <input class="btn btn-danger" type="submit" value="Delete">
        </form>
      </div>
    </div>
  </div>
</div>



{% endblock content %}

{% block custom_js %}
  <!-- Copy to Clipboard Javascript -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
  <script type="text/javascript">
    new ClipboardJS('.btn');
  </script>
{% endblock %}