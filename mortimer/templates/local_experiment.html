{% extends "layout.html" %}

{% block content %}

<div class="media content-section">
  <div class="media-body">
    <div>
      <a class="mr-2" href="#">{{ experiment.author }}</a>
      <small class="text-muted">{{ experiment.date_created.strftime('%Y-%m-%d') }}</small>
    </div>
    <legend class="border-bottom"><b>{{ experiment.title }}</b></legend>

    <div class="row">
      <div class="col-md-3"><small><b>Created in Mortimer</b></small>:</div><div class="col-md-3"><span class="badge badge-light">{{ experiment.date_created.strftime('%Y-%m-%d, %H:%M') }}</span></div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>Last Finished Dataset</b></small>:</div><div class="col-md-3"><span class="badge badge-light">{{ last_activity }}</span></div>
    </div>
    <div class="row">
      <div class="col-md-3"><small><b>First Finished Dataset</b></small>:</div><div class="col-md-3"><span class="badge badge-light">{{ first_activity }}</span></div>
    </div>

    <div class="row">
      <div class="col-md-3"><small><b>Version History</b></small>:</div><div class="col-md-3">
        {% if versions %}
        {% for version in versions %}
        <span class="badge badge-dark"> {{ version }}</span>
        {% endfor %}
        {% else %}
        <span class="badge badge-warning"> Experiment not found in database</span>
        {% endif %}
      </div>
    </div>

    <h6 class="border-bottom pt-4"><b>Description</b></h6>

      <p class="article-content">{{ experiment.description }}</p>  

    <!--  <p class="article-content">{{ experiment.script }}</p> -->
  </div>


</div>

<div class="article content-section">
  <legend><b>Options</b></legend>

        <a class="btn btn-primary mt-1 mb-1" href="{{ url_for('local_experiments.local_export', experiment_title=experiment.title, username=experiment.author) }}">Export Data</a>
        <button type="button" class="btn btn-danger btn mt-1 mb-1" data-toggle="modal" data-target="#deleteModal">Delete from Mortimer</button>
      
</div>

<div class="article content-section">
  <legend><b>Datasets</b></legend>

      <table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">N</th>
      <th scope="col" class="text-center"><span class="badge badge-success">Finished</span></th>
      <th scope="col" class="text-center"><span class="badge badge-warning">Unfinished</span></th>
      <th scope="col" class="text-center"><span class="badge badge-dark">Total</span></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">All Versions</th>
      <td class="text-center">{{ datasets["all_finished_datasets"] }}</td>
      <td class="text-center">{{ datasets["all_unfinished_datasets"] }}</td>
      <td class="text-center">{{ datasets["all_datasets"] }}</td>
    </tr>
    {% for version, info in versions.items() %}

    <tr>
      <th scope="row">Version {{ version }} </th>
      <td class="text-center">{{ info["finished"] }}</td>
      <td class="text-center">{{  info["unfinished"] }}</td>
      <td class="text-center">{{ info["total"] }}</td>
    </tr>

    {% endfor %}
  </tbody>
</table>

    </div>

<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Delete Experiment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure that you want to delete this experiment? The data stored in Mortimer will be lost! <br><br>The experimental data in the Alfred database will <b>not</b> be deleted by this.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <form action="{{ url_for('local_experiments.delete_experiment', experiment_title=experiment.title, username=experiment.author) }}">
          <input class="btn btn-danger" type="submit" value="Delete">
        </form>
      </div>
    </div>
  </div>
</div>



{% endblock content %}